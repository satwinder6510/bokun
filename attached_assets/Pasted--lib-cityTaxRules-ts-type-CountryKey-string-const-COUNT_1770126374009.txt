// lib/cityTaxRules.ts
type CountryKey = string;

const COUNTRY_TAX_RULES: Record<CountryKey, string> = {
  // ====== AUSTRIA ======
  "AT": "Austria: Local tourist tax is commonly charged and collected by the accommodation. Amount varies by municipality and hotel; often a small per-person, per-night charge, and in some places percentage-based. Payable locally at check-in/out.",

  // ====== ITALY ======
  "IT": "Italy: A municipal ‘tourist/city tax’ is widely charged (per person per night) and collected by the accommodation. Amount varies by city, season and property category; commonly ~€1–€10 per person per night, often capped after a set number of nights. Payable locally at check-in/out.",

  // ====== PORTUGAL ======
  "PT": "Portugal: Tourist tax applies in several major municipalities and is collected by the accommodation. Where charged, it is typically €2–€4 per person per night (often capped after ~7 nights). Payable locally at check-in/out.",

  // ====== NETHERLANDS ======
  "NL": "Netherlands: Municipal tourist tax is commonly charged and collected by the accommodation. It may be a percentage of the room price or a fixed amount depending on the city (e.g., Amsterdam uses a %). Payable locally at check-in/out unless your booking states it is included.",

  // ====== GERMANY ======
  "DE": "Germany: Some cities levy a local ‘city/bed/culture tax’ collected by the accommodation. Amount and method vary by city (fixed per person/night or % of room price). Payable locally where applicable.",

  // ====== SPAIN ======
  "ES": "Spain: Tourist taxes are regional/municipal and apply in some destinations (not nationwide). Where applicable, they are collected by the accommodation and vary by region, city and property category (often a per-person, per-night charge). Payable locally where applicable.",

  // ====== FRANCE ======
  "FR": "France: ‘Taxe de séjour’ (tourist tax) may apply depending on the municipality and accommodation classification. It is collected by the accommodation, typically per person per night or as a % for some property types. Payable locally unless your booking states it is included.",

  // ====== GREECE ======
  "GR": "Greece: A mandatory accommodation fee (often described as a climate resilience/civic charge) is collected by the accommodation. Amount varies by property category and season and is typically charged per room per night. Payable locally at check-in/out.",

  // ====== SWITZERLAND ======
  "CH": "Switzerland: A local visitor/‘Kurtaxe’ is common in many destinations and is collected by the accommodation. Amount varies by municipality (often a per-person, per-night charge) and may include guest card benefits. Payable locally.",

  // ====== BELGIUM ======
  "BE": "Belgium: Tourist tax is set locally and is common in major cities. It may be charged per person per night or per room per night depending on the municipality. Payable locally to the accommodation.",

  // ====== CROATIA ======
  "HR": "Croatia: A tourist/sojourn tax is generally charged for overnight stays and collected by the accommodation. Amount varies by season and destination and is typically per person per night. Payable locally.",
};

// Optional: also accept full country names if your data uses them
const COUNTRY_NAME_ALIASES: Record<string, string> = {
  "Austria": "AT",
  "Italy": "IT",
  "Portugal": "PT",
  "Netherlands": "NL",
  "Germany": "DE",
  "Spain": "ES",
  "France": "FR",
  "Greece": "GR",
  "Switzerland": "CH",
  "Belgium": "BE",
  "Croatia": "HR",
};

export function getCityTaxDisclosure(country: string): string {
  if (!country) {
    return "A local tourist/city tax may apply and is payable locally; amount depends on the municipality and accommodation type.";
  }

  const trimmed = country.trim();
  const code = trimmed.length === 2 ? trimmed.toUpperCase() : (COUNTRY_NAME_ALIASES[trimmed] ?? "");

  return (
    COUNTRY_TAX_RULES[code] ??
    "A local tourist/city tax may apply and is payable locally; amount depends on the municipality and accommodation type."
  );
}

export function uniqueCountries(countries: string[]): string[] {
  const set = new Set<string>();
  for (const c of countries) {
    if (!c) continue;
    const trimmed = c.trim();
    const code = trimmed.length === 2 ? trimmed.toUpperCase() : (COUNTRY_NAME_ALIASES[trimmed] ?? trimmed);
    set.add(code);
  }
  return Array.from(set);
}
